<html>
<head>
    <script src="https://aframe.io/releases/0.6.1/aframe.min.js"></script>
    <style>
    div.text {
        font: 24px impact;
        color: white;
        position:absolute;
        width:100%;
        text-align:center;
        z-index:100;
        display:block;
        -webkit-touch-callout: none; /* iOS Safari */
            -webkit-user-select: none; /* Safari */
             -khtml-user-select: none; /* Konqueror HTML */
               -moz-user-select: none; /* Firefox */
                -ms-user-select: none; /* Internet Explorer/Edge */
                    user-select: none; /* Non-prefixed version, currently
                                          supported by Chrome and Opera */
    }
    </style>
</head>
<body>
<script type="application/javascript">
// Intro music
var game = {
    inProgress: false,
    score: 0,
    highScore: document.cookie || 0
};
const growthFactor = 2; // How big it grows each interval
const interval = 1500; // How long each interval is
const resetInterval = 1000;
var colors = [
    '#1a1ee0','#d91ae0', '#e01a38',"#e0491a", '#e09b1a','#73e01a', '#966401', '#0350a0'
];
var colorIndex = 0;
var myAudioContext = new AudioContext;

const initialize = function () {
    game.inProgress = false;
    game.highScore = parseInt(document.cookie) || 0;
    // Screen text
    var scoreMessage = (game.score > 0) ? "Last: " + game.score + " " : "Swivel chair recommended. ";
    document.getElementById('score').setAttribute("canvas-text", "text: " + scoreMessage + " Best: " + game.highScore);
    document.getElementById('shapes').setAttribute("visible", false);
    document.getElementById('titleShape').setAttribute("visible", true);
    document.getElementById('instructions').setAttribute("visible", true);
    document.getElementById('sky').setAttribute('color', "#000000");
}
window.onload = initialize;

const newGame = function () {
    if (game.inProgress) return;
    game.inProgress = true;
    game.score = 0;
    document.getElementById('shapes').setAttribute("visible", true);
    document.getElementById('titleShape').setAttribute("visible", false);
    document.getElementById('instructions').setAttribute("visible", false);
    document.getElementById('score').setAttribute("canvas-text", "text:;");
    playSound("intro");
}
const increaseScore = function () {
    game.score++;
    playSound("point");
    document.getElementById('score').setAttribute("canvas-text", "text: " + game.score);
}

const gameOver = function () {
    game.inProgress = false;
    playSound("end");
    if (game.score > game.highScore) {
        // TODO: Celebrate new high score
        game.highScore = game.score;
        document.cookie = game.highScore;
    }
    initialize();
}

const playSound = function (soundName) {
    myAudioContext.close();
    myAudioContext = new AudioContext;
    if(soundName == "intro") {
        with(myAudioContext)[1,1,6,6,6,6,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,10,10,10,10,13,13,13,13,13,13,15,15,15,15].map((v,i)=>{with(createOscillator())v&&start(e=[15,16,5,6,13,14,21,22,23,24,25,26,28,29,30,31,32,33,34,36,27,35,3,4,11,12,1,2,7,9,17,19,8,10,18,20][i]/5,connect(destination),frequency.value=988/1.06**v,type='triangle',)+stop(e+.2)})
    } else if (soundName == "point") {
        let index = Math.floor(game.score / 4) % 5;
        if(index == 0) {
        with(myAudioContext)[18,18,20,20,22,23,23,25,25].map((v,i)=>{with(createOscillator())v&&start(e=[2,7,3,8,10,4,9,1,6][i]/5,connect(destination),frequency.value=988/1.06**v,type='triangle',)+stop(e+.2)})
        } else if (index == 1) {
            with(myAudioContext)[10,11,13,13,15,20,22].map((v,i)=>{with(createOscillator())v&&start(e=[3,4,6,7,5,2,1][i]/5,connect(destination),frequency.value=988/1.06**v,type='triangle',)+stop(e+.2)})
        } else if (index == 2) {
            with(myAudioContext)[13,13,15,15,18,18,18,20].map((v,i)=>{with(createOscillator())v&&start(e=[1,4,2,5,3,7,8,6][i]/5,connect(destination),frequency.value=988/1.06**v,type='triangle',)+stop(e+.2)})
        } else if (index == 3) {
            with(myAudioContext)[18,18,20,22,23,25,25,25,25].map((v,i)=>{with(createOscillator())v&&start(e=[1,7,2,4,3,5,6,8,9][i]/5,connect(destination),frequency.value=988/1.06**v,type='triangle',)+stop(e+.2)})
        } else {
            with(myAudioContext)[13,17,18,20,22,25,25].map((v,i)=>{with(createOscillator())v&&start(e=[6,5,3,4,2,1,7][i]/5,connect(destination),frequency.value=988/1.06**v,type='triangle',)+stop(e+.2)})
        }
    } else if (soundName == "end") {
        with(myAudioContext)[15,16,17,18,18].map((v,i)=>{with(createOscillator())v&&start(e=[1,2,3,4,5][i]/5,connect(destination),frequency.value=988/1.06**v,type='triangle',)+stop(e+.2)})
    }
}


